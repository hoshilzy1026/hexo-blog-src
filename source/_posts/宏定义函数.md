---
title: 宏定义函数
---

# # 宏定义函数是什么
<!-- more -->
## ## 为什么要使用宏定义函数

在C程序中，可以用宏代码提高执行效率。宏代码本身不是函数，但使用起来象函数。
预处理器用复制宏代码的方式代替函数调用，省去了参数压栈、生成汇编语言的CALL调用、
返回参数、执行return等过程，从而提高了速度。 （避免函数调用，提高程序效率）
使用宏代码最大的缺点是容易出错，预处理器在复制宏代码时常常产生意想不到的边际效应。

## ## 什么是宏
它是一种预处理器指令，在预编译阶段将宏名替换为后面的替换体 
## ## 如何使用宏

```c
  #define       MAx             960
  预处理指令		宏名       	替换体(多行可用 \ 延续) 

```

## ## 不带参数的宏

```c
#include <stdio.h>
#include <stdlib.h> 

#define _width 1024 //宏命名规则同变量名 
#define ADDR "中华人民共和国河南省" 

int main(void){ 
	printf("width: %d\n", _width); 
	printf("我的祖籍： %s\n", ADDR);

	return 0; 
}

```
运行结果：

```c
width: 1024
我的祖籍： 中华人民共和国河南省

```
## ## 带参数的宏（不是真正的参数）

```c
#include <stdio.h>
#include <stdlib.h> 

#define SQUARE(x) x*x  

int main(void) {
	int i = 10;
	int j = SQUARE(i); // 宏展开 j = i*i;
	int k = SQUARE(8 + 2); // 宏展开 8+2*8+2

	printf("j: %d\n", j);
	printf("k: %d\n", k);

	system("pause");
	return 0;
}

```

输出结果

```c
j: 100
k: 26
```
毋庸置疑，j = 100；但 k = 26，为啥？
宏只是一个替换，不会自动加括号，非常死板！
解决方法：

```c
#define SQUARE(x) ((x)*(x))  
```

## ## 原理
这里可以知道，使用宏比调用函数更加高效。因为，使用宏就像使用头文件一样，就比如使用<string.h>，使用头文件<string.h>进行预编译之后，直接可以使用字符串进行定义使用；宏也是如此，在定义宏之后，编译器直接进行了预编译，这时候调用它，就是直接进行替换。

而调用其他函数时，要给他在内存中单独分配空间，普通变量分布在栈区，动态内存分布在堆区，静态变量在全局数据区（全局数据区也包括全局变量），字符常量在常量区，二进制指令（也就是函数体）分布在代码区。执行这个函数时，要获取被调用函数指定的地址（被调用函数的地址有一个范围，起始地址就是函数的入口地址，被调用函数从起始地址开始一步步往下执行），之后程序会跳转到被调函数的第一条语句，一步步往下依次执行被调函数中的语句，直到函数执行结束。
## ## Tips
如果宏函数与函数名称相同，优先使用宏定义函数
例如：

```c
#include <stdio.h>
// div function prototype
float div(float, float);
#define div(x, y) x / y

int main()
{
// use of macro div
// Note: %0.2f for taking two decimal value after point
printf("%0.2f", div(10.0, 5.0));
// removing defined macro div
#undef div
// function div is called as macro definition is removed
printf("\n%0.2f", div(10.0, 5.0));
return 0;
}

// div function definition
float div(float x, float y) { return y / x; }

```
结果是：

```c
2.00
0.50

```